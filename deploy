#! /bin/zsh

# git pull source
echo "**************BEGIN GIT PULL SOURCE**************"
git pull origin source

if [ $? != 0 ]
then
echo "**************GIT PULL SOURCE FAILED**************"
exit 1
else
echo "**************GIT PULL SOURCE SUCCESS**************"
fi


# hexo generate
echo "**************BEGIN HEXO GENERATE**************"
hexo clean
hexo generate

if [ $? != 0 ]
then
echo "**************HEXO GENERATE FAILED**************"
exit 1
else
echo "**************HEXO GENERATE SUCCESS**************"
fi


# git push source
echo "**************GIT PUSH SOURCE BEGIN**************"
git add --all .
git commit -m "update at `date` "
git push origin source
if [ $? != 0 ]
then
echo "**************GIT PUSH SOURCE FAILED**************"
exit 1
else
echo "**************GIT PUSH SOURCE SUCCESS**************"
fi


# 创建发布用 git 仓库
cd public
git init
git add .

if [ -n "$1" ];
then
git commit -m "$1"
else
git commit -m "update at `date`"
fi

# 添加云服务器源
echo "**************PUSH TO CLOUD BEGIN**************"
# 改变云服务器 remote url
git remote add cloud git@81.70.132.212:/home/git/hexo.git
# 提交博客内容
git push -u cloud master -f

if [ $? != 0 ]
then
echo "**************PUSH TO CLOUD FAILED**************"
exit 1
else
echo "**************PUSH TO CLOUD SUCCESS**************"
fi

# 添加 github 源
echo "**************PUSH TO GITHUB BEGIN**************"
# 改变 github remote url
git remote add origin git@github.com:wangzz/wangzz.github.com.git >> /dev/null 2>&1
# 提交博客内容
git push origin master -f

if [ $? != 0 ]
then
echo "**************PUSH TO GITHUB FAILED**************"
exit 1
else
echo "**************PUSH TO GITHUB SUCCESS**************"
fi

cd -

echo "**************DONE**************"