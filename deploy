#! /bin/zsh

# git pull source
echo "**************BEGIN GIT PULL SOURCE**************"
git pull origin source

if [ $? != 0 ]
then
echo "**************GIT PULL SOURCE FAILED**************"
exit 1
else
echo "**************GIT PULL SOURCE SUCCESS**************"
fi


# hexo generate
echo "**************BEGIN HEXO GENERATE**************"
hexo clean
hexo generate

if [ $? != 0 ]
then
echo "**************HEXO GENERATE FAILED**************"
exit 1
else
echo "**************HEXO GENERATE SUCCESS**************"
fi


# git push source
echo "**************GIT PUSH BEGIN**************"
git add --all .
git commit -m "update at `date` "
git push origin source
if [ $? != 0 ]
then
echo "**************GIT PUSH FAILED**************"
exit 1
else
echo "**************GIT PUSH SUCCESS**************"
fi


# 创建发布用 git 仓库
cd public
git init
git add .
git commit -m "update at `date` "

# 添加 gitee 源
echo "**************PUSH TO GITEE BEGIN**************"
# 改变 gitee remote url
git remote add gitee git@gitee.com:wangzz/wangzz.git >> /dev/null 2>&1
# 提交博客内容
git push -u gitee master -f

if [ $? != 0 ]
then
echo "**************PUSH TO GITEE FAILED**************"
exit 1
else
echo "**************PUSH TO GITEE SUCCESS**************"
fi

# 添加 github 源
echo "**************PUSH TO GITHUB BEGIN**************"
# 改变 github remote url
git remote add origin git@github.com:wangzz/wangzz.github.com.git >> /dev/null 2>&1
# 提交博客内容
git push origin master -f

if [ $? != 0 ]
then
echo "**************PUSH TO GITHUB FAILED**************"
exit 1
else
echo "**************PUSH TO GITHUB SUCCESS**************"
fi

cd -

echo "**************DONE**************"