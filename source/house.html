<html>

<head>
    <title>公房税费计算</title>
</head>

<style>
  .second {
    font-size: 20px;
  }
</style>

<body style="background-color:rgb(253, 251, 251); font-size: 30px">
  <div>
    <span>房屋总价</span>
    <input id='totalPrice'></input>
  </div>
  <div style="margin-bottom: 20px;">
    <span>评估价比例</span>
    <input id='outEstimatedInput' value=0.98></input>
  </div>
  <span>首付信息：</span>
  <div>
    <span class="second">总首付款</span>
    <span class="second" id='totalPay'>0</span>
  </div>
  <div>
    <span class="second">非贷款金额</span>
    <span class="second" id='outLoans'>0</span>
  </div>
  <div>
    <span class="second">评估外金额</span>
    <span class="second" id='outEstimatedValue'>0</span>
  </div>
  <div>
    <span class="second">契税</span>
    <span class="second" id='deedTax'>0</span>
  </div>
  <div style="margin-bottom: 20px;">
    <span class="second">中介费</span>
    <span class="second" id='agencyFee'>0</span>
  </div>
  <span>其它信息：</span>
  <div>
    <span class="second">评估价</span>
    <span class="second" id='canLoans'>0</span>
  </div>
  <div>
    <span class="second">总贷款</span>
    <span class="second" id='loans'>0</span>
  </div>
  <div style="font-size: 15px;margin-top: 20px;">
    <span>说明：契税 3%，中介费 2.5%</span>
  </div>
</body>

<script>
  const getFloat = function(num, n) {
    const dotIndex = `${num}`.indexOf('.');
    if (dotIndex < 0) {
      return num;
    }

    n = n ? parseInt(n) : 0;
    if(n <= 0) {
      return Math.round(num);
    }
    num = Math.round(num * Math.pow(10, n)) / Math.pow(10, n); //四舍五入
    // num = Number(num).toFixed(n); //补足位数
    return num;
  };

  const dotLength = 2; // 小数点后保留位数
  const locansRatio = 0.4; // 贷款比例

  const totalPrice = document.getElementById("totalPrice");
  const totalPay = document.getElementById("totalPay");
  const outEstimatedValue = document.getElementById("outEstimatedValue");
  const outEstimatedInput = document.getElementById("outEstimatedInput");
  const outLoans = document.getElementById('outLoans');
  const deedTax = document.getElementById("deedTax");
  const agencyFee = document.getElementById("agencyFee");
  const loans = document.getElementById("loans");
  const canLoans = document.getElementById("canLoans");

  const updateShow = function () {
    const totalValue = parseInt(totalPrice.value || 0); // 房屋总价
    const estimatedRatio = parseFloat(outEstimatedInput.value || 0.98); // 房屋评估价和房屋售价比例
    
    const canLoansPrice = estimatedRatio * totalValue; // 评估价
    const outEstimatedValuePrice = (1 - estimatedRatio) * totalValue; // 评估外价值
    const deedTaxPrice = 0.03 * canLoansPrice; // 契税
    const agencyFeePrice = 0.025 * totalValue; // 中介费
    const loansPrice = canLoansPrice * locansRatio; // 可贷款总额
    const outLoansPrice = canLoansPrice - loansPrice; // 非贷款金额
    const totalPayPrice = outLoansPrice + outEstimatedValuePrice + deedTaxPrice + agencyFeePrice; // 总首付款

    totalPay.innerText = getFloat(totalPayPrice, dotLength);
    outLoans.innerText = getFloat(outLoansPrice, dotLength);
    outEstimatedValue.innerText = getFloat(outEstimatedValuePrice, dotLength);
    deedTax.innerText = getFloat(deedTaxPrice, dotLength);
    agencyFee.innerText = getFloat(agencyFeePrice, dotLength);
    loans.innerText = getFloat(loansPrice, dotLength);
    canLoans.innerText = getFloat(canLoansPrice, dotLength);
  };

  totalPrice.addEventListener('change', ()=> {
    updateShow();
  });

  outEstimatedInput.addEventListener('change', ()=> {
    updateShow();
  });
</script>

</html>
